runnableVersion: 01.00.00
name: runnableHttpJsonPayload
id: http
initialDelay: 0
runnables:
- timeout: 3000
  name: HttpTitle
  subscriptions:
  - type: http-server
    name: HttpSubscriptionTitle
    endpoint: /enqueuer/:someId
    port: 23075
    method: POST
    response:
      status: 321
      payload: responsePayload
    onMessageReceived: >-
      message = JSON.parse(message);
      test['Params is someId'] = message.params.someId === 'idStuff';
      test['Query is 123'] = message.query.query === '123';
      test['Payload is Virgs'] = JSON.parse(message.body).enqueuer === 'virgs';
    timeout: 10000
  startEvent:
    publisher:
      type: http-client
      name: HttpPublisherClientTitle
      url: http://localhost:23075/enqueuer/idStuff?query=123
      method: POST
      prePublishing: test['prePublishingTest'] = true
      onMessageReceived: >-
        test['publisherOnMessageReceivedTest'] = JSON.parse(message).statusCode == 321;
        test['publisherOnMessageReceivedPayloadTest'] = JSON.parse(message).body == 'responsePayload'
      payload:
        enqueuer: virgs
      headers:
        content-type: application/json
