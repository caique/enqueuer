name: hooks example
id: hook
runnables:
- timeout: 1000
  onInit: >-
    tester.isDefined('Requisition exists', requisition);
    store.sequence = 'requisition::onInit';
  name: example
  startEvent:
    publisher:
      type: tcp-client
      serverAddress: localhost
      port: 23080
      name: publishing
      payload: it
      onInit: >-
        tester.isDefined('Publisher exists onInit', publisher);
        tester.isEqualTo('Publisher name', publisher.name, 'publishing');
        publisher.name = 'changed';
        store.sequence += ' -> publisher::onInit';
      onMessageReceived: >-
        tester.isDefined('Publisher exists onMessageReceived', publisher);
        tester.isEqualTo('Publisher name changed', publisher.name, 'changed');
        tester.contains('Publisher onInit executed', store.sequence, 'publisher::onInit');
        store.sequence += ' -> publisher::onMessageReceived';
  subscriptions:
    - type: tcp-server
      name: subscription
      port: 23080
      response: hook response
      onInit: >-
        tester.isDefined('Subscription exists onInit', subscription);
        tester.isEqualTo('Subscription name', subscription.name, 'subscription');
        subscription.name = 'changed';
        store.sequence += ' -> subscription::onInit';
      onMessageReceived: >-
        tester.isDefined('Subscription exists onMessageReceived', subscription);
        tester.isEqualTo('Subscription name changed', subscription.name, 'changed');
        tester.contains('Subscription onInit executed', store.sequence, 'subscription::onInit');
        store.sequence += ' -> subscription::onMessageReceived';
