timeout: 10000
startEvent:
    publisher:
        type: http-client
        url: http://localhost:23075/file/replace
        method: POST
        payload: <<json://misc/file-content.json>>
        onMessageReceived:
            assertions:
                -   name: fileRead
                    expect: JSON.parse(message.body).key
                    toBeEqualTo: publisher.payload.key
subscriptions:
    -   type: http-server
        endpoint: /file/replace
        port: 23075
        method: POST
        response:
            status: 200
            payload: <<yaml://misc/file-content.yml>>
        onMessageReceived:
            script: <<file://misc/file-code.js>>
            assertions:
                -   name: fileRead
                    expect: JSON.parse(message.body).key
                    toBeEqualTo: subscription.response.payload.key
                -   name: code loaded
                    expect: doubleValue
                    toBeEqualTo: JSON.parse(message.body).valueToBeMultipliedBy2 * 2
