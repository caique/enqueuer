name: amqp test description
id: amqp
runnables:
- name: requisition description
  timeout: 5000
  startEvent:
    publisher:
      type: amqp
      name: publisher description
      payload:
        how:
          about: a new object?
      options:
        host: localhost
        port: 5672
      exchange: enqueuer.exchange
      messageOptions:
        headers:
          key: value
          otherKey: otherValue
      routingKey: enqueuer.integration.test.routing.key
      onInit:
        assertions:
          - expected: publisher.options.port
            isEqualTo: 5672
  subscriptions:
  - name: subscription description
    type: amqp
    timeout: 3000
    options:
      host: localhost
      port: 5672
    queueName: enqueuer.queue.name
    exchange: enqueuer.exchange
    routingKey: enqueuer.integration.test.routing.#
    onMessageReceived:
      assertions:
        - name: Payload
          expected: payload.how.about
          isEqualTo: `a new object?`
        - name: Header
          expected: headers.key
          isEqualTo: `value`
        - name: Other Header Value
          expected: headers.otherKey
          isEqualTo: `otherValue`
        - name: Routing Key
          expected: deliveryInfo.routingKey
          isEqualTo: `enqueuer.integration.test.routing.key`
