name: runnableAmqp
id: amqp
runnables:
- timeout: 5000
  name: AmqpReq
  startEvent:
    publisher:
      type: amqp
      name: AmqpPub
      payload:
        how:
          about: a new object?
      options:
        host: localhost
        port: 5672
      exchange: enqueuer.exchange
      messageOptions:
        headers:
          key: value
          otherKey: otherValue
      routingKey: enqueuer.integration.test.routing.key
      onInit:
        assertions:
          - label: Port
            expected: publisher.options.port
            isEqualTo: 5672
  subscriptions:
  - type: amqp
    name: AmqpSubs
    options:
      host: localhost
      port: 5672
    queueName: enqueuer.queue.name
    exchange: enqueuer.exchange
    routingKey: enqueuer.integration.test.routing.#
    onMessageReceived:
      assertions:
        - label: Payload
          expected: payload.how.about
          isEqualTo: `a new object?`
        - label: Header
          expected: headers.key
          isEqualTo: `value`
        - label: Other Header Value
          expected: headers.otherKey
          isEqualTo: `otherValue`
        - label: Routing Key
          expected: deliveryInfo.routingKey
          isEqualTo: `enqueuer.integration.test.routing.key`
    timeout: 3000