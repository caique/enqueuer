runnableVersion: 01.00.00
name: runnableAmqp
id: amqp
initialDelay: 0
runnables:
- timeout: 5000
  name: AmqpReq
  startEvent:
    publisher:
      type: amqp
      name: AmqpPub
      payload: I'll be replaced by prePublishing function
      options:
        host: localhost
        port: 5672
      exchange: enqueuer.exchange
      messageOptions:
        headers:
          key: value
          otherKey: otherValue
      routingKey: enqueuer.integration.test.routing.key
      prePublishing: publisher.payload=new Date().getTime();
  subscriptions:
  - type: amqp
    name: AmqpSubs
    options:
      host: localhost
      port: 5672
    queueName: enqueuer.queue.name
    exchange: enqueuer.exchange
    routingKey: enqueuer.integration.test.routing.#
    onMessageReceived: >-
      tester.isGreaterThanOrEqualTo('Payload replaced', new Date().getTime(), message.data);
      tester.isEqualTo('Header', message.headers.key, 'value');
    timeout: 3000