name: runnableAmqp
id: amqp
runnables:
- timeout: 5000
  name: AmqpReq
  startEvent:
    publisher:
      type: amqp
      name: AmqpPub
      payload:
        how:
          about: a new object?
      options:
        host: localhost
        port: 5672
      exchange: enqueuer.exchange
      messageOptions:
        headers:
          key: value
          otherKey: otherValue
      routingKey: enqueuer.integration.test.routing.key
  subscriptions:
  - type: amqp
    name: AmqpSubs
    options:
      host: localhost
      port: 5672
    queueName: enqueuer.queue.name
    exchange: enqueuer.exchange
    routingKey: enqueuer.integration.test.routing.#
    onMessageReceived: >-
      tester.isEqualTo('Payload', message.payload.how.about, 'a new object?');
      tester.isEqualTo('Header', message.headers.key, 'value');
      tester.isEqualTo('Other header value', message.headers.otherKey, 'otherValue');
      tester.isEqualTo('Routing key', message.deliveryInfo.routingKey, 'enqueuer.integration.test.routing.key');
    timeout: 3000